{
    "$schema": "./aws-deploy-recipe-schema.json",
    "Id": "ConsoleAppEcsFargateService",
    "Name": "Console Application to ECS Fargate Service",
    "DeploymentType": "CdkProject",
    "DeploymentBundle": "Container",
    "CdkProjectTemplate": "../CdkTemplates/ConsoleAppECSFargateService",
    "CdkProjectTemplateId": "netdeploy.ConsoleAppEcsFargateService",
    "Description": "Console application built as a container and deployed as a service in Elastic Container Service. This is meant for console applications that run indefinitely like message processing applications.",
    "TargetService": "AWS Elastic Container Service",
    
    "RecipePriority": 110,
    "RecommendationRules": [
        {
            "Tests": [
                {
                    "Type" : "MSProjectSdkAttribute",
                    "Condition": {
                        "Value": "Microsoft.NET.Sdk"
                    }
                },
                {
                    "Type": "MSProperty",
                    "Condition": {
                        "PropertyName": "TargetFramework",
                        "AllowedValues": [ "netcoreapp2.1", "netcoreapp3.1", "net5.0" ]
                    }
                },
                {
                    "Type": "MSProperty",
                    "Condition": {
                        "PropertyName": "OutputType",
                        "AllowedValues": [ "Exe" ]
                    }
                }
            ],
            "Effect": {
                "Pass": { "Include": true }
            }
        },

        {
            "Tests": [
                {
                    "Type":"FileExists",
                    "Condition": {
                        "FileName": "Dockerfile"
                    }
                }
            ],
            "Effect": {
                "Fail": {
                    "PriorityAdjustment": -55,
                    "Include": true
                }
            }
        },


        {
            "Tests": [
                {
                    "Type": "MSPropertyExists",
                    "Condition": {
                        "PropertyName": "AWSProjectType"
                    }
                }
            ],
            "Effect": {
                "Pass": { "Include": false },
                "Fail": { "Include": true }
            }
        }
    ],

    

    "OptionSettings": [
        {
            "Id": "ClusterName",
            "Name": "Cluster Name",
            "Description": "The name of the ECS cluster.",
            "Type": "String",
            "TypeHint": "ECSCluster",
            "DefaultValue": "{ProjectName}",
            "AdvancedSetting": false,
            "Updatable": false
        },
        {
            "Id": "ECSServiceName",
            "ParentSettingId": "ClusterName",
            "Name": "ECS Service Name",
            "Description": "The name of the ECS service running in the cluster.",
            "Type": "String",
            "TypeHint": "ECSService",
            "DefaultValue": "{ProjectName}-service",
            "AdvancedSetting": false,
            "Updatable": false
        },
        {
            "Id": "DesiredCount",
            "Name": "Desired Task Count",
            "Description": "The desired number of ECS tasks to run for the service.",
            "Type": "Int",
            "DefaultValue": "3",
            "AdvancedSetting": false,
            "Updatable": true
        },
        {
            "Id": "ApplicationIAMRole",
            "Name": "Application IAM Role",
            "Description": "The Identity and Access Management Role that provides AWS credentials to the application to access AWS services",
            "Type": "String",
            "TypeHint": "IAMRole",
            "DefaultValue": "aws-ecs-role",
            "AdvancedSetting": false,
            "Updatable": false
        },
        {
            "Id": "UseExistingVPC",
            "Name": "Use Existing VPC",
            "Description": "Do you want to use an existing VPC for the deployment?",
            "Type": "Bool",
            "DefaultValue": "false",
            "AdvancedSetting": true,
            "Updatable": true
        },
        {
            "Id": "ExistingVPC",
            "Name": "Existing VPC Id",
            "Description": "The Id of the existing VPC to use.",
            "Type": "String",
            "DefaultValue": "",
            "DependsOn": [
                {
                    "Id": "UseExistingVPC",
                    "Value": "true"
                }
            ],
            "AdvancedSetting": true,
            "Updatable": true
        },
        {
            "Id": "UseDefaultVPC",
            "Name": "Use Default VPC",
            "Description": "Do you want to use the default VPC for the deployment?",
            "Type": "Bool",
            "DefaultValue": "false",
            "AllowedValues": [
                "yes"
            ],
            "ValueMapping": {
                "yes": "true"
            },
            "DependsOn": [
                {
                    "Id": "UseExistingVPC",
                    "Value": "true"
                },
                {
                    "Id": "ExistingVPC",
                    "Value": ""
                }
            ],
            "AdvancedSetting": true,
            "Updatable": true
        },
        {
            "Id": "AddDockerBuildArgs",
            "Name": "Add Docker Build Args",
            "Description": "Do you want to pass additional Docker build args?",
            "Type": "Bool",
            "DefaultValue": "false",
            "AdvancedSetting": true,
            "Updatable": true
        },
        {
            "Id": "DockerBuildArgs",
            "Name": "Docker Build Args",
            "Description": "The list of additional docker build args.",
            "Type": "String",
            "DefaultValue": "",
            "DependsOn": [
                {
                    "Id": "AddDockerBuildArgs",
                    "Value": "true"
                }
            ],
            "AdvancedSetting": true,
            "Updatable": true
        },
        {
            "Id": "DockerExecutionDirectory",
            "Name": "Docker Execution Directory",
            "Description": "Specifies the docker execution directory where the docker build command will be executed from.",
            "Type": "String",
            "DefaultValue": "",
            "AdvancedSetting": true,
            "Updatable": true
        }
    ]
}
